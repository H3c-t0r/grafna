test backend integration postgres tests
go clean -testcache
GRAFANA_TEST_DB=postgres \
	go test -p=1 -count=1 -run "^TestIntegration" -covermode=atomic -timeout=10m ./pkg/cmd/grafana-cli/commands/ ./pkg/infra/db/ ./pkg/infra/filestorage/ ./pkg/infra/kvstore/ ./pkg/infra/remotecache/ ./pkg/infra/serverlock/ ./pkg/plugins/manager/ ./pkg/services/accesscontrol/database/ ./pkg/services/accesscontrol/resourcepermissions/ ./pkg/services/alerting/ ./pkg/services/annotations/annotationsimpl/ ./pkg/services/anonymous/anonimpl/ ./pkg/services/apikey/apikeyimpl/ ./pkg/services/dashboards/database/ ./pkg/services/dashboards/service/ ./pkg/services/dashboardsnapshots/database/ ./pkg/services/dashboardversion/dashverimpl/ ./pkg/services/datasources/service/ ./pkg/services/folder/folderimpl/ ./pkg/services/live/database/tests/ ./pkg/services/live/managedstream/ ./pkg/services/loginattempt/loginattemptimpl/ ./pkg/services/ngalert/sender/ ./pkg/services/ngalert/store/ ./pkg/services/org/orgimpl/ ./pkg/services/playlist/playlistimpl/ ./pkg/services/pluginsintegration/pluginsettings/service/ ./pkg/services/preference/prefimpl/ ./pkg/services/publicdashboards/api/ ./pkg/services/publicdashboards/database/ ./pkg/services/queryhistory/ ./pkg/services/quota/quotaimpl/ ./pkg/services/secrets/manager/ ./pkg/services/serviceaccounts/database/ ./pkg/services/sqlstore/ ./pkg/services/sqlstore/permissions/ ./pkg/services/star/starimpl/ ./pkg/services/stats/statsimpl/ ./pkg/services/store/ ./pkg/services/store/entity/tests/ ./pkg/services/tag/tagimpl/ ./pkg/services/team/teamimpl/ ./pkg/services/temp_user/tempuserimpl/ ./pkg/services/user/userimpl/ ./pkg/tests/api/alerting/ ./pkg/tests/api/azuremonitor/ ./pkg/tests/api/correlations/ ./pkg/tests/api/dashboards/ ./pkg/tests/api/elasticsearch/ ./pkg/tests/api/graphite/ ./pkg/tests/api/influxdb/ ./pkg/tests/api/loki/ ./pkg/tests/api/opentdsb/ ./pkg/tests/api/plugins/ ./pkg/tests/api/plugins/backendplugin/ ./pkg/tests/api/prometheus/ ./pkg/tests/api/stats/ ./pkg/tests/web/ ./pkg/tsdb/mysql/ ./pkg/tsdb/postgres/
ok  	github.com/grafana/grafana/pkg/cmd/grafana-cli/commands	5.956s	coverage: 27.2% of statements
ok  	github.com/grafana/grafana/pkg/infra/db	18.139s	coverage: 32.4% of statements
ok  	github.com/grafana/grafana/pkg/infra/filestorage	0.386s	coverage: 0.0% of statements
ok  	github.com/grafana/grafana/pkg/infra/kvstore	1.682s	coverage: 47.4% of statements
ok  	github.com/grafana/grafana/pkg/infra/remotecache	0.398s	coverage: 0.0% of statements
ok  	github.com/grafana/grafana/pkg/infra/serverlock	1.606s	coverage: 76.2% of statements
ok  	github.com/grafana/grafana/pkg/plugins/manager	1.264s	coverage: 0.0% of statements
ok  	github.com/grafana/grafana/pkg/services/accesscontrol/database	8.066s	coverage: 8.8% of statements
ok  	github.com/grafana/grafana/pkg/services/accesscontrol/resourcepermissions	8.918s	coverage: 49.3% of statements
ok  	github.com/grafana/grafana/pkg/services/alerting	14.939s	coverage: 34.0% of statements
ok  	github.com/grafana/grafana/pkg/services/annotations/annotationsimpl	2.765s	coverage: 67.6% of statements
ok  	github.com/grafana/grafana/pkg/services/anonymous/anonimpl	3.745s	coverage: 86.7% of statements
ok  	github.com/grafana/grafana/pkg/services/apikey/apikeyimpl	6.345s	coverage: 50.4% of statements
ok  	github.com/grafana/grafana/pkg/services/dashboards/database	27.786s	coverage: 60.5% of statements
ok  	github.com/grafana/grafana/pkg/services/dashboards/service	25.172s	coverage: 32.1% of statements
ok  	github.com/grafana/grafana/pkg/services/dashboardsnapshots/database	1.567s	coverage: 76.3% of statements
ok  	github.com/grafana/grafana/pkg/services/dashboardversion/dashverimpl	1.708s	coverage: 37.3% of statements
ok  	github.com/grafana/grafana/pkg/services/datasources/service	87.880s	coverage: 21.1% of statements
ok  	github.com/grafana/grafana/pkg/services/folder/folderimpl	9.293s	coverage: 64.5% of statements
ok  	github.com/grafana/grafana/pkg/services/live/database/tests	1.045s	coverage: 100.0% of statements
ok  	github.com/grafana/grafana/pkg/services/live/managedstream	0.256s	coverage: 0.0% of statements
ok  	github.com/grafana/grafana/pkg/services/loginattempt/loginattemptimpl	5.486s	coverage: 37.9% of statements
ok  	github.com/grafana/grafana/pkg/services/ngalert/sender	21.925s	coverage: 74.9% of statements
ok  	github.com/grafana/grafana/pkg/services/ngalert/store	10.280s	coverage: 43.6% of statements
ok  	github.com/grafana/grafana/pkg/services/org/orgimpl	7.534s	coverage: 58.5% of statements
ok  	github.com/grafana/grafana/pkg/services/playlist/playlistimpl	1.712s	coverage: 56.2% of statements
ok  	github.com/grafana/grafana/pkg/services/pluginsintegration/pluginsettings/service	1.047s	coverage: 86.7% of statements
ok  	github.com/grafana/grafana/pkg/services/preference/prefimpl	2.755s	coverage: 38.1% of statements
ok  	github.com/grafana/grafana/pkg/services/publicdashboards/api	1.088s	coverage: 22.5% of statements
ok  	github.com/grafana/grafana/pkg/services/publicdashboards/database	14.415s	coverage: 80.0% of statements
ok  	github.com/grafana/grafana/pkg/services/queryhistory	24.400s	coverage: 82.8% of statements
ok  	github.com/grafana/grafana/pkg/services/quota/quotaimpl	4.282s	coverage: 58.4% of statements
ok  	github.com/grafana/grafana/pkg/services/secrets/manager	4.573s	coverage: 52.2% of statements
ok  	github.com/grafana/grafana/pkg/services/serviceaccounts/database	1.092s	coverage: 15.0% of statements
ok  	github.com/grafana/grafana/pkg/services/sqlstore	2.752s	coverage: 35.0% of statements
ok  	github.com/grafana/grafana/pkg/services/sqlstore/permissions	9.351s	coverage: 74.8% of statements
ok  	github.com/grafana/grafana/pkg/services/star/starimpl	1.643s	coverage: 73.9% of statements
ok  	github.com/grafana/grafana/pkg/services/stats/statsimpl	1.598s	coverage: 92.2% of statements
ok  	github.com/grafana/grafana/pkg/services/store	5.319s	coverage: 3.7% of statements
ok  	github.com/grafana/grafana/pkg/services/store/entity/tests	0.774s	coverage: 0.0% of statements
ok  	github.com/grafana/grafana/pkg/services/tag/tagimpl	1.658s	coverage: 59.5% of statements
ok  	github.com/grafana/grafana/pkg/services/team/teamimpl	7.029s	coverage: 74.2% of statements
ok  	github.com/grafana/grafana/pkg/services/temp_user/tempuserimpl	5.708s	coverage: 60.7% of statements
ok  	github.com/grafana/grafana/pkg/services/user/userimpl	9.903s	coverage: 55.3% of statements
ok  	github.com/grafana/grafana/pkg/tests/api/alerting	0.745s	coverage: 0.0% of statements
ok  	github.com/grafana/grafana/pkg/tests/api/azuremonitor	16.016s	coverage: [no statements]
ok  	github.com/grafana/grafana/pkg/tests/api/correlations	21.386s	coverage: [no statements]
--- FAIL: TestIntegrationUpdatingProvisionionedDashboards (1.57s)
    testinfra.go:37: Grafana is listening on 127.0.0.1:58857
    --- FAIL: TestIntegrationUpdatingProvisionionedDashboards/when_provisioned_directory_is_not_empty,_dashboard_should_be_created (0.27s)
        --- FAIL: TestIntegrationUpdatingProvisionionedDashboards/when_provisioned_directory_is_not_empty,_dashboard_should_be_created/when_updating_provisioned_dashboard_using_ID_it_should_fail (0.03s)
            api_dashboards_test.go:232: 
                	Error Trace:	/Users/josefk/go/src/github.com/grafana/grafana/pkg/tests/api/dashboards/api_dashboards_test.go:232
                	Error:      	Not equal: 
                	            	expected: 400
                	            	actual  : 500
                	Test:       	TestIntegrationUpdatingProvisionionedDashboards/when_provisioned_directory_is_not_empty,_dashboard_should_be_created/when_updating_provisioned_dashboard_using_ID_it_should_fail
            api_dashboards_test.go:245: 
                	Error Trace:	/Users/josefk/go/src/github.com/grafana/grafana/pkg/tests/api/dashboards/api_dashboards_test.go:245
                	Error:      	Not equal: 
                	            	expected: "Cannot save provisioned dashboard"
                	            	actual  : "Internal Server Error - please inspect Grafana server log for details"
                	            	
                	            	Diff:
                	            	--- Expected
                	            	+++ Actual
                	            	@@ -1 +1 @@
                	            	-Cannot save provisioned dashboard
                	            	+Internal Server Error - please inspect Grafana server log for details
                	Test:       	TestIntegrationUpdatingProvisionionedDashboards/when_provisioned_directory_is_not_empty,_dashboard_should_be_created/when_updating_provisioned_dashboard_using_ID_it_should_fail
FAIL
coverage: [no statements]
FAIL	github.com/grafana/grafana/pkg/tests/api/dashboards	4.967s
ok  	github.com/grafana/grafana/pkg/tests/api/elasticsearch	3.372s	coverage: [no statements]
ok  	github.com/grafana/grafana/pkg/tests/api/graphite	3.388s	coverage: [no statements]
ok  	github.com/grafana/grafana/pkg/tests/api/influxdb	3.525s	coverage: [no statements]
ok  	github.com/grafana/grafana/pkg/tests/api/loki	3.514s	coverage: [no statements]
ok  	github.com/grafana/grafana/pkg/tests/api/opentdsb	3.527s	coverage: [no statements]
ok  	github.com/grafana/grafana/pkg/tests/api/plugins	6.501s	coverage: [no statements]
ok  	github.com/grafana/grafana/pkg/tests/api/plugins/backendplugin	12.162s	coverage: [no statements]
ok  	github.com/grafana/grafana/pkg/tests/api/prometheus	3.368s	coverage: [no statements]
ok  	github.com/grafana/grafana/pkg/tests/api/stats	0.736s	coverage: [no statements]
ok  	github.com/grafana/grafana/pkg/tests/web	14.836s	coverage: [no statements]
ok  	github.com/grafana/grafana/pkg/tsdb/mysql	0.342s	coverage: 0.0% of statements
ok  	github.com/grafana/grafana/pkg/tsdb/postgres	0.505s	coverage: 35.5% of statements
FAIL
