<div class="variable-link-wrapper">
	<a ng-click="vm.show()" class="variable-value-link">
		{{vm.linkText}}
		<span ng-repeat="tag in vm.selectedTags" bs-tooltip='tag.valuesText' data-placement="bottom">
			<span class="label-tag"tag-color-from-name="tag.text">
				&nbsp;&nbsp;<i class="fa fa-tag"></i>&nbsp;
				{{tag.text}}
			</span>
		</span>
		<i class="fa fa-caret-down" style="font-size:12px"></i>
	</a>

	<input type="text" class="gf-form-input" style="display: none" ng-keydown="vm.keyDown($event)" ng-model="vm.search.query" ng-change="vm.queryChanged()" ></input>

	<div class="variable-value-dropdown" ng-if="vm.dropdownVisible" ng-class="{'multi': vm.variable.multi, 'single': !vm.variable.multi}">
		<div class="variable-options-wrapper">
			<div class="variable-options-column">
				<a class="variable-options-column-header" ng-if="vm.variable.multi" ng-class="{'many-selected': vm.selectedValues.length > 1, 'expanded': vm.showDisplayed}" bs-tooltip="'Clear selections'" data-placement="top">
					<span ng-click="vm.clearSelections()"><span class="variable-option-icon"></span>
					Selected ({{vm.selectedValues.length}})</span>
					<span class="keep-dropdown-open" ng-if="vm.selectedValues.length > 0 && !vm.showDisplayed" ng-click="vm.showDisplayed = true"><i class="fa fa-plus-square-o keep-dropdown-open"></i></span>
					<span class="keep-dropdown-open" ng-if="vm.selectedValues.length > 0 && vm.showDisplayed" ng-click="vm.showDisplayed = false"><i class="fa fa-minus-square-o keep-dropdown-open"></i></span>
				</a>
				<span class="variable-options-column-header-selections" ng-if="vm.showDisplayed && vm.selectedValues.length > 0"> 
					<a class="selected variable-option pointer keep-dropdown-open" ng-if="vm.variable.multi && vm.selectedValues.length > 0" ng-repeat="option in vm.selectedValues" data-placement="top" ng-click="vm.selectValue(option, $event)">
						<span class="variable-option-icon keep-dropdown-open"></span>
						<span>{{option.text}}</span>
					</a>
				</span>
				<a class="variable-option pointer" ng-repeat="option in vm.search.options" ng-class="{'selected': option.selected, 'highlighted': $index === vm.highlightIndex}" ng-click="vm.selectValue(option, $event)">
					<span class="variable-option-icon"></span>
					<span>{{option.text}}</span>
				</a>
			</div>
			<div class="variable-options-column" ng-if="vm.tags.length">
				<div class="variable-options-column-header text-center">
					Tags
				</div>
				<a class="variable-option-tag pointer" ng-repeat="tag in vm.tags" ng-click="vm.selectTag(tag, $event)" ng-class="{'selected': tag.selected}">
					<span class="fa fa-fw variable-option-icon"></span>
					<span class="label-tag" tag-color-from-name="tag.text">{{tag.text}}&nbsp;&nbsp;<i class="fa fa-tag"></i>&nbsp;</span>
				</a>
			</div>
		</div>
	</div>
</div>
