import { feedToDataFrame } from './utils';
import { RssFeed, NewsItem } from './types';
import { DataFrameView } from '@grafana/data';

describe('news', () => {
  test('convert RssFeed to DataFrame', () => {
    const frame = feedToDataFrame(grafana_2019_12_16);
    expect(frame.length).toBe(5);

    // Iterate the links
    const view = new DataFrameView<NewsItem>(frame);
    const links = view.map(item => {
      return item.link;
    });
    expect(links).toEqual([
      'https://grafana.com/blog/2019/12/13/meet-the-grafana-labs-team-aengus-rooney/',
      'https://grafana.com/blog/2019/12/12/register-now-grafanacon-2020-is-coming-to-amsterdam-may-13-14/',
      'https://grafana.com/blog/2019/12/10/pro-tips-dashboard-navigation-using-links/',
      'https://grafana.com/blog/2019/12/09/how-to-do-automatic-annotations-with-grafana-and-loki/',
      'https://grafana.com/blog/2019/12/06/meet-the-grafana-labs-team-ward-bekker/',
    ]);
  });
});

const grafana_2019_12_16 = {
  items: [
    {
      title: 'Meet the Grafana Labs Team: Aengus Rooney',
      link: 'https://grafana.com/blog/2019/12/13/meet-the-grafana-labs-team-aengus-rooney/',
      pubDate: 'Fri, 13 Dec 2019 00:00:00 +0000',
      content: '\n\n<p>As Grafana Labs continues to grow, we&rsquo;d like you to get to know the team members...',
      contentSnippet:
        'As Grafana Labs continues to grow, we&rsquo;d like you to get to know the team members who are working on the cool stuff you&rsquo;re using. Check out the latest of our Friday team profiles.\n\nMeet Aengus!\n\nName: Aengus Rooney\n\n\n    \n        \n        \n        Grafana Labs Solutions Engineer Aengus Rooney\n    \n\n\nCurrent location/time zone\nGreenwich Meridian - BST.\n\nWhat do you do at Grafana Labs?\nSolutions Engineering. We take Grafana’s existing and new releases and help our prospects and clients integrate with our SaaS offerings, and/or deploy our software to their own environments.\n\nWhat open source projects do you contribute to?\nASF projects and more recently CNCF projects. Currently working on Grafana, Prometheus, and Loki!\n\nWhat are your GitHub and Twitter handles?\nTwitter - @aengusrooney | GitHub - aengusrooneygrafana.\n\nWhat do you like to do in your free time?\nReading and some exercise! Jogging, cycling, swimming…\n\nWhat’s your favorite new gadget or tech toy?\nAn IoT project using home weather stations…\n\nDo you like to code in silence, with music or ambient noise on your headphones, or with people talking around you?\nWith music for sure! I find electronic/progressive house and trance the best for concentration. However I’m a fan of many different genres of music!!\n\nWhat do you do to get “in the zone” when you code?\nTurn off all comms channels and listen to music!\n\nFavorite ice cream flavor?\nMatcha and sesame.\n\nWhat’s the last thing you binge-watched?\nMr. Robot.\n\nSpaces or tabs?\nSpaces definitely!! I’ve wasted too much time porting code with tabs across platforms to work with tabs anymore…\n\nWhat superhero powers do you wish you had (or do you have!)?\nFlying, super-power vision and hearing, mind reading, shooting laser beams… there’s so many useful things really…',
      guid: 'https://grafana.com/blog/2019/12/13/meet-the-grafana-labs-team-aengus-rooney/',
      isoDate: '2019-12-13T00:00:00.000Z',
    },
    {
      title: 'Register Now! GrafanaCon 2020 Is Coming to Amsterdam May 13-14',
      link: 'https://grafana.com/blog/2019/12/12/register-now-grafanacon-2020-is-coming-to-amsterdam-may-13-14/',
      pubDate: 'Thu, 12 Dec 2019 00:00:00 +0000',
      content: '\n\n<p>Amsterdam, we&rsquo;re coming back!</p>\n\n<p>Mark your calendars for May 13-14, 2020....',
      contentSnippet:
        'Amsterdam, we&rsquo;re coming back!\n\nMark your calendars for May 13-14, 2020. Two years after a frozen GrafanaCon, we&rsquo;ll be in the city of canals again, but this time in full spring. And if you already know you want to go &ndash; or have 2019 budget to spend &ndash; you can take advantage of early-bird registration here and pay just 199 euro, a savings of 300 euro off the regular price. Early-bird pricing is good through the end of the year.\n\nRegister now to secure your spot for GrafanaCon 2020, two days of talks and demos on the latest features, functionality, and use cases of Grafana, Loki, and everything else you love in the open source monitoring ecosystem. And be the first to hear exciting updates about the open, composable observability platform we’re building.\n\nLearning\n\nGet first-hand accounts of monitoring at every scale. Last year, we heard from a company bringing renewable energy to rural Africa, and engineers at Tinder and Verizon. Verizon shared that it saw a 100,000% reduction in stored procedure code and 4,000% decrease in total stored procedures with Grafana. Yup, you read that right.\n\nAnother highlight was a talk from Kubernetes co-creator Brendan Burns, who shared his lessons learned monitoring cloud native systems.\n\n\n\nNetworking\n\nMeet your LinkedIn connections and open source co-contributors in real life. Find curious fellow engineers, hobbyists, and people just learning about observability and data visualization.\n\nCommunity\n\nAttendees include many contributors and maintainers of Grafana, Prometheus, Loki and more. In both sessions and the hallway track, you can get to know them and learn how to navigate an open source project and make contributions.\n\nShare Your Knowledge\n\nWe are looking for great speakers! Let us know your interest by responding to our Call for Presenters before the January 31 deadline.\n\nReady to see what GrafanaCon 2020 will bring?\n\n\n    \n\n\n\n\n\n\nRegister Now!',
      guid: 'https://grafana.com/blog/2019/12/12/register-now-grafanacon-2020-is-coming-to-amsterdam-may-13-14/',
      isoDate: '2019-12-12T00:00:00.000Z',
    },
    {
      title: 'Pro Tips: Dashboard Navigation Using Links',
      link: 'https://grafana.com/blog/2019/12/10/pro-tips-dashboard-navigation-using-links/',
      pubDate: 'Tue, 10 Dec 2019 00:00:00 +0000',
      content:
        '\n\n<p>Great dashboards answer a limited set of related questions. If you try to answer too many questions in a single dashboard, it can become overly complex. ...',
      contentSnippet:
        'Great dashboards answer a limited set of related questions. If you try to answer too many questions in a single dashboard, it can become overly complex. As a consequence, a single dashboard often can&rsquo;t tell the whole story. So you end up navigating between several, and it can be quite inefficient to search for a particular dashboard every time you need it.\n\nLuckily, there are some hacks for navigating between dashboards.\n\nFor starters: Did you know that you can search for a dashboard, no matter where you are, by pressing S and O on your keyboard?\n\nIn this article, we&rsquo;ll look at how you can use links to navigate between commonly used dashboards. Links let you create shortcuts to other dashboards and even external websites.\n\nGrafana supports three types of links: Dashboard Links, Panel Links, and Data Links. They are all available from your dashboard.\n\n\n\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\n\t\t\t\n\t\t\n\t\n\n\n\n\nDashboard Links\n\nImagine you have a dashboard displaying HTTP request rates and errors for your services. You&rsquo;ve zoomed in on an interval with several errors, and you suspect it&rsquo;s related to the underlying hardware. Using Dashboard Links, you can create a shortcut to a dashboard displaying resource usage for the host machines where the service is running.\n\nWhen you create a Dashboard Link, you have the option to include the time range and current template variables to directly jump to the same context in another dashboard. This way, you don’t have to worry whether you’re looking at the right data.\n\nThey can also be used as shortcuts to external systems, such as submitting a GitHub issue with the current dashboard name.\n\nTo add a Dashboard Link, go to Dashboard settings -> Links, and click New. Once you&rsquo;ve added a Dashboard Link, it will appear in the upper right corner of your dashboard.\n\n\n\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\n\t\t\t\n\t\t\n\t\n\n\n\n\nTo see an example of Dashboard Links in action, check out this demo.\n\nPanel Links\n\nOften, Dashboard Links are all you need for linking between dashboards. But imagine that you have a high-level dashboard with several panels representing different systems, and you want to link to separate dashboards for each system. With Dashboard Links, it&rsquo;s not always obvious which link to click to drill down into that service. Instead, use Panel Links to create a link from a specific panel. That way, it&rsquo;s easier to find the drill-down link for that system.\n\nEach panel can have its own set of links that will appear in the upper left corner of your panel. To add a Panel Link, open the General tab in the panel settings and find the Panel Links section.\n\n\n\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\n\t\t\t\n\t\t\n\t\n\n\n\n\nYou can even add one of the template variables that are available. Press Ctrl + Space in the URL field to see the available variables. By adding template variables to your Panel Link, the link sends the user to the right context, with the relevant variables already set. You can even control the time range to ensure the user is zoomed in on the right data.\n\nTo see an example of Panel Links in action, check out this demo.\n\nData Links\n\nData Links, which were recently added to Grafana, allow you to provide even more granular context to your links. You can create links that include the series name or even the value under the cursor. Currently, Data Links are only supported in the Graph, Gauge, and Bar Gauge visualizations.\n\nTo add a Data Link, go to the Visualization tab in the panel settings, and find the Data Links section. Click on a point in your graph to access your Data Links. Your links appear in the context menu.\n\n\n\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\n\t\t\t\n\t\t\n\t\n\n\n\n\nTo see an example of Data Links in action, check out this demo. Refer to the documentation for more information on Data Links.\n\nWhich Should You Use?\n\nTo understand what links you should use in your Grafana install, start by figuring out how you&rsquo;re currently navigating between dashboards. If you&rsquo;re often jumping between a set dashboards and struggling to find the same context in each, links can help you optimize your workflow.\n\nThe next step is to figure out which link type is right for your workflow. Even though all the link types in Grafana are used to create shortcuts to other dashboards or external websites, they work in different contexts:\n\n\nIf the link relates to most if not all of the panels in the dashboard, use a Dashboard Link.\nIf you want to drill down into specific panels, the Panel Links are your friend.\nIf you want to drill down into a specific series, or even a single measurement, you&rsquo;ll want to use Data Links.\n\n\nMake sure to check back for more ways to improve your Grafana workflow!',
      guid: 'https://grafana.com/blog/2019/12/10/pro-tips-dashboard-navigation-using-links/',
      isoDate: '2019-12-10T00:00:00.000Z',
    },
    {
      title: 'How to Do Automatic Annotations with Grafana and Loki',
      link: 'https://grafana.com/blog/2019/12/09/how-to-do-automatic-annotations-with-grafana-and-loki/',
      pubDate: 'Mon, 09 Dec 2019 00:00:00 +0000',
      content:
        '\n\n<p>Grafana annotations are great! They clearly mark the occurrence of an event to help operators and devs correlate events with metrics. You may not be aware of this, but Grafana can automatically annotate graphs by ...',
      contentSnippet:
        'Grafana annotations are great! They clearly mark the occurrence of an event to help operators and devs correlate events with metrics. You may not be aware of this, but Grafana can automatically annotate graphs by querying Loki. Here’s a look at how to use this feature.\n\nGrafana Loki Annotations\n\nLoki queries can be used to automatically generate annotations on Grafana dashboards since 6.4.0. For every log line that is returned from a query, the text is automatically displayed as an annotation at the appropriate time.\n\nTo add an annotation query, simply navigate to Dashboard Settings -> Annotations -> New and select a Loki data source. Type a query that selects log lines you want to show up as annotations, and you’re ready to go:\n\n\n\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\n\t\t\t\n\t\t\n\t\n\n\n\n\nNote that we are explicitly querying any changes to a deployment named ingester in the loki namespace. If we query these logs directly, they look like this:\n\n\n\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\n\t\t\t\n\t\t\n\t\n\n\n\n\nkubernetes-diff-logger\n\nIn the above example, we are querying lines logged by an application called the kubernetes-diff-logger. This is a simple open source application that logs any changes to a set of Kubernetes objects we want to watch. It currently supports watching deployments, statefulsets, and daemonsets but could easily be extended to support more. Feel free to jump in and contribute!\n\nThe raw output of the logger looks like this:\n\n{"timestamp":"2019-10-30T12:48:52Z","verb":"updated","type":"deployment","notes":"[Template.Spec.Containers.slice[0].Image: grafana/loki:master-d5758e3 != grafana/loki:master-d080e46]","name":"ingester","namespace":"tempo-dev"}\n{"timestamp":"2019-10-30T13:38:59Z","verb":"updated","type":"deployment","notes":"[Template.Spec.Containers.slice[0].Image: grafana/loki:master-d080e46 != grafana/loki:master-38d803a]","name":"ingester","namespace":"tempo-dev"}\n{"timestamp":"2019-10-30T18:35:54Z","verb":"updated","type":"deployment","notes":"[Template.Spec.Containers.slice[0].Image: grafana/loki:master-38d803a != grafana/loki:master-dd4c138]","name":"ingester","namespace":"tempo-dev"}\n\n\nNotice that this application is logging in JSON. Let’s use Promtail next to extract key fields that we can query directly as Loki labels.\n\nPromtail Configuration\n\nPromtail includes a highly configurable pipeline that we will use to extract JSON fields as Loki labels and rewrite the log line itself.\n\n  - match:\n      selector: \'{name="kube-diff-logger"}\'\n      stages:\n      - json:\n          expressions:\n            diff_name: name\n            diff_namespace: namespace\n            diff_type: type\n            diff_verb: verb\n            notes: notes\n            timestamp: timestamp\n      - timestamp:\n          format: RFC3339\n          source: timestamp\n      - labels:\n          diff_name: ""\n          diff_namespace: ""\n          diff_type: ""\n          diff_verb: ""\n      - output:\n          source: notes\n\n\nThis configuration extracts the name, namespace, type and verb JSON fields and makes them available for direct querying using a Logql query like this:\n\n{container_name="kube-diff-logger", diff_namespace="loki", diff_type=”deployment”, diff_name="ingester"}\n\n\nAlso, the output step will rewrite the log line with just the value of the notes field. This is important because it will be used as the note for the annotation as shown below.\n\nPutting the Pieces Together\n\nNow that we have set up our annotation query and are logging the desired events, we should start seeing annotations on our dashboards.\n\nThe below memory usage dashboard is showing annotations when our Loki ingester deployment updates. Naturally this correlates with memory usage resetting because the Kubernetes pods are rolling. With this technique, you can correlate changes to latency, success rates, or any other metrics directly to changes in your deployments.\n\n\n\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\n\t\t\t\n\t\t\n\t\n\n\n\n\nMousing over the annotation shows the exact change! In this case, the image was changed; i.e., a new version of the application was built and rolled out.\n\n\n\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\n\t\t\t\n\t\t\n\t\n\n\n\n\nFinal Thoughts\n\nAutomatic annotations are a fantastic way to guarantee that any changes to your application’s Kubernetes infrastructure are clearly marked on your Grafana graphs. Give it a try today!\n\nAlso, if kubernetes-diff-logger is lacking some features you are interested in, feel free to submit an issue or PR. It’s a small project with a lot of potential and a fun way to get involved in open source development!',
      guid: 'https://grafana.com/blog/2019/12/09/how-to-do-automatic-annotations-with-grafana-and-loki/',
      isoDate: '2019-12-09T00:00:00.000Z',
    },
    {
      title: 'Meet the Grafana Labs Team: Ward Bekker',
      link: 'https://grafana.com/blog/2019/12/06/meet-the-grafana-labs-team-ward-bekker/',
      pubDate: 'Fri, 06 Dec 2019 00:00:00 +0000',
      content:
        '\n\n<p>As Grafana Labs continues to grow, we&rsquo;d like you to get to know the team members who are building the cool stuff you&rsquo;re using. Check out the latest of our Friday team profiles.</p>\n\n<h2 id="meet-ward">Meet Ward!</h2>\n\n<p><strong>Name:</strong> Ward...',
      contentSnippet:
        'As Grafana Labs continues to grow, we&rsquo;d like you to get to know the team members who are building the cool stuff you&rsquo;re using. Check out the latest of our Friday team profiles.\n\nMeet Ward!\n\nName: Ward Bekker\n\n\n    \n        \n        \n        Grafana Labs Solutions Engineer Ward Bekker\n    \n\n\nCurrent location/time zone:\nI live in a small village between Amsterdam and Den Haag (The Hague), so CET/CEST.\n\nWhat do you do at Grafana Labs?\nI recently joined Grafana Labs as Solutions Engineer (SE). My goal is to be the trusted technical advisor for our prospects and customers, so they can get the most value out of our products. That means helping out prospects with any technical question during their pilot of our products, and making sure their pilot is a great success. I can&rsquo;t do this alone, as one cannot be an expert on everything (although I keep trying). So if a prospect has a hard question, I&rsquo;ll work closely with the other solutions engineers and the engineering teams to make sure the hard questions also get answered.\n\nWhat open source projects do you contribute to?\nI recently got my first pull request merged into Loki and published LokiLogger, an Elixir logger backend providing support for logging to Grafana Loki. In the past I&rsquo;ve contributed to Apache Metron, a big data cybersecurity solution, and I&rsquo;ve added Erlang support to Travis-CI in the early days. I&rsquo;ve also published a few small open source repositories, like an Erlang implementation of a famous Top-K Query algorithm and an Erlang client for the Neurosky ECG headset.\n\nWhat are your GitHub and Twitter handles?\nGitHub: wardbekker, and Twitter: @wardbekker. Also check out my YouTube channel for Grafana and Loki videos. (I also blogged about it.)\n\nWhat do you like to do in your free time?\nHanging out with my wife and two kids, ideally in a place with incredible nature. I also like to run, preferably long distance.\n\nWhat’s your favorite new gadget or tech toy?\nThat must be my Topo Standing Desk Mat. Sitting for long periods of time doesn&rsquo;t feel very healthy, so I&rsquo;m a big fan of my standing desk. This funny-shaped Topo mat makes it very comfortable to stand for long periods of time.\n\nDo you like to code in silence, with music or ambient noise on your headphones, or with people talking around you?\nI like to get in the coding flow state with a nice mix of music from folks like Orbital, David Bowie, Talking Heads, Talk Talk, and some fresh electronica.\n\nWhat do you do to get “in the zone” when you code?\nIdeally, when I know nobody&rsquo;s going to interrupt me for a good few hours. Amazing what you can get done in those situations.\n\nFavorite ice cream flavor?\nIf I must choose one, it&rsquo;s strawberry cheesecake.\n\nWhat’s the last thing you binge-watched?\nThe Mind Explained, on Netflix. The series is narrated by Emma Stone and examines what happens inside our brains when we dream, are anxious, and more.\n\nSpaces or tabs?\nAuto code formatter based on project style guide. It&rsquo;s all good folks.\n\nWhat superhero powers do you wish you had (or do you have!)?\nMy superpower is that I can fall asleep whenever I want. Comes in handy when you travel a lot.',
      guid: 'https://grafana.com/blog/2019/12/06/meet-the-grafana-labs-team-ward-bekker/',
      isoDate: '2019-12-06T00:00:00.000Z',
    },
  ],
  feedUrl: 'https://grafana.com/blog/index.xml',
  title: 'Blog on Grafana Labs',
  description: 'Recent content in Blog on Grafana Labs',
  generator: 'Hugo -- gohugo.io',
  link: 'https://grafana.com/blog/',
  language: 'en-us',
  lastBuildDate: 'Fri, 13 Dec 2019 00:00:00 +0000',
} as RssFeed;
