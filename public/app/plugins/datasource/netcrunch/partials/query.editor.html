<div class="tight-form net-crunch-tight-form"
     ng-class="{'tight-form-disabled': target.hide}">

  <!-- Right side menu -->
  <ul class="tight-form-list pull-right">
    <li ng-show = "target.localVars.counterError" class = "tight-form-item">
      <a bs-tooltip = "target.localVars.counterErrorMessage"
         style = "color: rgb(229, 189, 28)" role = "menuitem">
        <i class = "fa fa-warning"></i>
      </a>
    </li>
    <li class="tight-form-item small" ng-show="target.datasource">
      <em>{{target.datasource}}</em>
    </li>
    <li class="tight-form-item">
      <div class="dropdown">
        <a class="pointer dropdown-toggle"
           data-toggle="dropdown">
          <i class="fa fa-bars"></i>
        </a>
        <ul class="dropdown-menu pull-right" role="menu">
          <li role="menuitem">
            <a ng-click="duplicateDataQuery(target)">
              Duplicate
            </a>
          </li>
          <li ng-if="$index > 0" role="menuitem">
            <a ng-click="moveDataQuery($index, $index-1)">
              Move up
            </a>
          </li>
          <li ng-if="$index < (panel.targets.length - 1)" role="menuitem">
            <a ng-click="moveDataQuery($index, $index+1)">
              Move down
            </a>
          </li>
        </ul>
      </div>
    </li>
    <li class="tight-form-item last">
      <a class="pointer" ng-click="removeDataQuery(target)">
        <i class="fa fa-remove"></i>
      </a>
    </li>
  </ul>

  <!-- Left side options -->
  <ul class="tight-form-list">
    <li class="tight-form-item" style="min-width: 15px; text-align: center">
      {{target.refId}}
    </li>
    <li>
      <a class="tight-form-item"
         ng-click="target.hide = !target.hide; get_data();"
         role="menuitem">
         <i class="fa fa-eye"></i>
      </a>
    </li>
  </ul>

  <ul class="tight-form-list">

    <!-- Node selection -->
    <li class="tight-form-item tile spinner"
        ng-show="target.localVars.nodeSpinner"
        tabindex="1">
      <ng-spinner spinner-show-trigger = "target.localVars.processingNode"
                  spinner-state = "target.localVars.nodeSpinner"
                  spinner-delay = "350">
        <img src = "img/load_big.gif">
      </ng-spinner>
    </li>
    <li class="tight-form-item tile"
        ng-focus-me="target.localVars.nodeFocus"
        ng-hide="target.localVars.nodeSpinner"
        ng-enter-click
        ng-down-arrow-click
        ng-click="nodeSelectionTypeAhead()"
        tabindex="1">
      <div class="node-icon">
        <img ng-src={{target.localVars.nodeIcon}}>
      </div>
      <div class="tile-description">
        <div class="node-name">{{target.localVars.nodeName}}</div>
        <div class="node-address">{{target.localVars.nodeAddress}}</div>
      </div>
    </li>
    <ng-type-ahead class="nodes-selection-container"
                   input-element="#node-input{{$index}}"
                   content-element="#nodes-list{{$index}}"
                   on-esc = "closeNodeSelectionTypeAhead()"
                   ng-show="nodeSelectionShow">
      <input type="text"
             class="tight-form-clear-input node-input"
             ng-focus-me="nodeSelectionFocus"
             spellcheck="false"
             ng-model="nodeNamePattern"
             tabindex="1"
             id="node-input{{$index}}">
      <div class="close-type-ahead-button"
           ng-click="closeNodeSelectionTypeAhead()">
        <i class="fa fa-remove"></i>
      </div>
      <div class="nodes-ahead dropdown-menu" id="nodes-panel{{$index}}">
        <ng-spinner class = "net-crunch-container spinner"
                    spinner-show-trigger = "processingNodes"
                    spinner-state = "nodesSpinner"
                    spinner-delay = "350">
          <img src = "img/load_big.gif">
        </ng-spinner>
        <div class="net-crunch-container" id="nodes-list{{$index}}"
             ng-virtual-scroll-list
             ng-virtual-scroll-list-parent="#nodes-panel{{$index}}"
             ng-hide="nodesSpinner">
          <div class="tile-list-element"
               ng-repeat="node in nodes | netCrunchNodes : nodeNamePattern track by node.values.Id"
               ng-virtual-scroll-list-element-height="40"
               tabindex="{{node.local.tabIndex}}"
               ng-click="selectNode(node)">
            <div class="node-icon">
              <img ng-src={{node.local.iconUrl}}>
            </div>
            <div class="tile-description">
              <div class="node-name">{{node.values.Name}}</div>
              <div class="node-address">{{node.values.Address}}</div>
            </div>
          </div>
        </div>
      </div>
    </ng-type-ahead>

    <!-- Counter selection -->
    <li class="tight-form-item counter spinner"
        ng-show="target.localVars.counterSpinner"
        tabindex="1">
      <ng-spinner
        spinner-show-trigger = "target.localVars.processingCounter"
        spinner-state = "target.localVars.counterSpinner"
        spinner-delay = "350">
        <img src = "img/load_big.gif">
      </ng-spinner>
    </li>
    <li class="tight-form-item counter"
        ng-focus-me="target.localVars.counterFocus"
        ng-hide="target.localVars.counterSpinner"
        ng-enter-click
        ng-down-arrow-click
        ng-click="counterSelectionTypeAhead()"
        tabindex="1">
      {{target.localVars.counterDisplayName}}
    </li>

    <!-- Series options -->
    <li class="tight-form-item" ng-hide="panel.scopedVars.rawData">
      <input class="cr1" id="netCrunchMin{{$index}}" type="checkbox"
             ng-model="target.series.min"
             ng-change="seriesChange()">
      <label for="netCrunchMin{{$index}}" class="cr1">Min</label>
    </li>
    <li class="tight-form-item" ng-hide="panel.scopedVars.rawData">
      <input class="cr1" id="netCrunchAvg{{$index}}" type="checkbox"
             ng-model="target.series.avg"
             ng-change="seriesChange()">
      <label for="netCrunchAvg{{$index}}" class="cr1">Avg</label>
    </li>
    <li class="tight-form-item" ng-hide="panel.scopedVars.rawData">
      <input class="cr1" id="netCrunchMax{{$index}}" type="checkbox"
             ng-model="target.series.max"
             ng-change="seriesChange()">
      <label for="netCrunchMax{{$index}}" class="cr1">Max</label>
    </li>
  </ul>

  <div class="clearfix"></div>
</div>
