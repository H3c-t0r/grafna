<div class="editor-row"
     ng-controller="netCrunchQueryCtrl as ctrl"
     ng-init="init()">

  <div class="tight-form net-crunch-tight-form"
       ng-class="{'tight-form-disabled': target.hide}"
       ng-repeat="target in panel.targets">

    <ul class="tight-form-list pull-right">
      <li ng-show = "target.localVars.counterError" class = "tight-form-item">
        <a bs-tooltip = "target.localVars.counterErrorMessage"
           style = "color: rgb(229, 189, 28)" role = "menuitem">
          <i class = "fa fa-warning"></i>
        </a>
      </li>
      <li class="tight-form-item">
        <div class="dropdown">
          <a class="pointer dropdown-toggle"
             data-toggle="dropdown">
            <i class="fa fa-bars"></i>
          </a>
          <ul class="dropdown-menu pull-right" role="menu">
            <li role="menuitem">
              <a ng-click="duplicateCounterQuery($index)">
                Duplicate
              </a>
            </li>
            <li ng-if="$index > 0" role="menuitem">
              <a ng-click="moveCounterQuery($index, $index-1)">
                Move up
              </a>
            </li>
            <li ng-if="$index < (panel.targets.length - 1)" role="menuitem">
              <a ng-click="moveCounterQuery($index, $index+1)">
                Move down
              </a>
            </li>
          </ul>
        </div>
      </li>
      <li class="tight-form-item last">
        <a class="pointer" ng-click="removeDataQuery(target)">
          <i class="fa fa-remove"></i>
        </a>
      </li>
    </ul>

    <ul class="tight-form-list">
      <li class="tight-form-item" style="min-width: 15px; text-align: center">
        {{counterLetters[$index]}}
      </li>
      <li>
        <a class="tight-form-item"
           ng-click="target.hide = !target.hide; get_data();"
           role="menuitem">
           <i class="fa fa-eye"></i>
        </a>
      </li>
    </ul>

    <ul class="tight-form-list">
      <li class="tight-form-item tile spinner"
          ng-show="target.localVars.nodeSpinner"
          tabindex="1">
        <ng-spinner spinner-show-trigger = "target.localVars.processingNode"
                    spinner-state = "target.localVars.nodeSpinner"
                    spinner-delay = "350">
          <img src = "img/load_big.gif">
        </ng-spinner>
      </li>
      <li class="tight-form-item tile"
          node-type-ahead={{$index}}
          ng-focus-me="target.localVars.nodeFocus"
          ng-hide="target.localVars.nodeSpinner"
          ng-enter-click
          ng-down-arrow-click
          ng-click="nodeSelectionTypeAhead($index)"
          tabindex="1">
        <div class="node-icon">
          <img ng-src={{target.localVars.nodeIcon}}>
        </div>
        <div class="tile-description">
          <div class="node-name">{{target.localVars.nodeName}}</div>
          <div class="node-address">{{target.localVars.nodeAddress}}</div>
        </div>
      </li>

      <li class="tight-form-item counter spinner"
          ng-show="target.localVars.counterSpinner"
          tabindex="1">
        <ng-spinner
          spinner-show-trigger = "target.localVars.processingCounter"
          spinner-state = "target.localVars.counterSpinner"
          spinner-delay = "350">
          <img src = "img/load_big.gif">
        </ng-spinner>
      </li>
      <li class="tight-form-item counter"
          counter-type-ahead={{$index}}
          ng-focus-me="target.localVars.counterFocus"
          ng-hide="target.localVars.counterSpinner"
          ng-enter-click
          ng-down-arrow-click
          ng-click="counterSelectionTypeAhead($index)"
          tabindex="1">
        {{target.localVars.counterDisplayName}}
      </li>

      <li class="tight-form-item" ng-hide="panel.scopedVars.rawData">
        <input class="cr1" id="min{{$index}}" type="checkbox"
               ng-model="target.series.min"
               ng-change="seriesChange(target)">
        <label for="min{{$index}}" class="cr1">Min</label>
      </li>

      <li class="tight-form-item" ng-hide="panel.scopedVars.rawData">
        <input class="cr1" id="avg{{$index}}" type="checkbox"
               ng-model="target.series.avg"
               ng-change="seriesChange(target)">
        <label for="avg{{$index}}" class="cr1">Avg</label>
      </li>

      <li class="tight-form-item" ng-hide="panel.scopedVars.rawData">
        <input class="cr1" id="max{{$index}}" type="checkbox"
               ng-model="target.series.max"
               ng-change="seriesChange(target)">
        <label for="max{{$index}}" class="cr1">Max</label>
      </li>
    </ul>

    <div class="clearfix"></div>
  </div>
  <div class="tight-form"></div>
  <ng-type-ahead class="nodes-selection-container"
                 type-ahead-name = "node-type-ahead"
                 type-ahead-position = "nodeSelectionPosition"
                 input-element="#node-input"
                 content-element="#nodes-list"
                 on-esc = "closeNodeSelectionTypeAhead()"
                 ng-show="nodeSelectionShow">
    <input type="text"
           class="tight-form-clear-input node-input"
           ng-focus-me="nodeSelectionFocus"
           spellcheck="false"
           ng-model="nodeNamePattern"
           tabindex="1"
           id="node-input">
    <div class="nodes-ahead dropdown-menu" id="nodes-panel">
      <ng-spinner class = "net-crunch-container spinner"
                  spinner-show-trigger = "processingNodes"
                  spinner-state = "nodesSpinner"
                  spinner-delay = "350">
        <img src = "img/load_big.gif">
      </ng-spinner>
      <div class="net-crunch-container" id="nodes-list"
           ng-virtual-scroll-list
           ng-virtual-scroll-list-parent="#nodes-panel"
           ng-hide="nodesSpinner">
        <div class="tile"
             ng-repeat="node in nodes | netCrunchNodes : nodeNamePattern track by node.values.Id"
             ng-virtual-scroll-list-element-height="40"
             tabindex="{{node.local.tabIndex}}"
             ng-click="selectNode(node)">
          <div class="node-icon">
            <img ng-src={{node.local.iconUrl}}>
          </div>
          <div class="tile-description">
            <div class="node-name">{{node.values.Name}}</div>
            <div class="node-address">{{node.values.Address}}</div>
          </div>
        </div>
      </div>
    </div>
  </ng-type-ahead>
  <ng-type-ahead class="counter-selection-container"
                 type-ahead-name = "counter-type-ahead"
                 type-ahead-position = "counterSelectionPosition"
                 input-element="#counter-input"
                 content-element="#counters-list"
                 on-esc = "closeCounterSelectionTypeAhead()"
                 ng-show = "counterSelectionShow">
    <input type="text"
           class="tight-form-clear-input counter-input"
           ng-focus-me="counterSelectionFocus"
           spellcheck="false"
           ng-model="counterNamePattern"
           tabindex="1"
           id="counter-input">
    <div class="counters-ahead dropdown-menu" id="counters-panel">
      <ng-spinner class = "net-crunch-container spinner"
                          spinner-show-trigger = "processingCounters"
                          spinner-state = "countersSpinner"
                          spinner-delay = "350">
        <img src = "img/load_big.gif">
      </ng-spinner>
      <div class="counters-levels" id="counters-list"
           ng-hide="countersSpinner"
           ng-tree="counter in counters | netCrunchCounter : counterNamePattern"
           ng-tree-class="counter-level"
           ng-tree-scroll-parent="counters-panel"
           ng-tree-config="counterListConfig">

          <div ng-tree-inner-level="counter.innerLevel"
               ng-click="selectCounter(counter)"
               tabindex="{{counter.tabIndex}}">
            {{counter.displayName}}
          </div>
      </div>
    </div>
  </ng-type-ahead>
</div>

<section class="grafana-metric-options"
         ng-controller="netCrunchOptionsCtrl as ctrl"
         ng-init="init()">
  <div class="tight-form">
    <ul class="tight-form-list">
      <li class="tight-form-item tight-form-item-icon">
        <i class="fa fa-wrench"></i>
      </li>

      <li class="tight-form-item">
        <input class="cr1" id="rawData" type="checkbox"
               ng-model="panel.scopedVars.rawData"
               ng-change="metricOptionsChange(panel.scopedVars)">
        <label for="rawData" class="cr1">RAW data</label>
      </li>

      <li class="tight-form-item" ng-hide="panel.scopedVars.rawData"
          bs-tooltip="'Override max data points. Default value is {{defaultMaxDataPoints}}.'">
        <input class="cr1" id="setMaxDataPoints" type="checkbox"
               ng-model="panel.scopedVars.setMaxDataPoints"
               ng-change="metricOptionsChange(panel.scopedVars)">
        <label for="setMaxDataPoints" class="cr1">Max data points</label>
      </li>

      <li ng-show="panel.scopedVars.setMaxDataPoints && !panel.scopedVars.rawData"
          bs-tooltip="'Value should be from {{defaultMinMaxDataPoints}} to
                                            {{defaultMaxMaxDataPoints}}.'">
        <input type="text"
               class="input-mini tight-form-input"
               ng-model="panel.scopedVars.maxDataPoints"
               ng-pattern = "maxDataPointsPattern" required
               data-placement = "right"
               ng-model-onblur ng-change="metricOptionsChange(panel.scopedVars)"
               spellcheck = 'false'
               placeholder="200">
      </li>
    </ul>
    <div class="clearfix"></div>
  </div>
</section>
