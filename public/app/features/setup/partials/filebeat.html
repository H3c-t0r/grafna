<topnav section="安装指南" icon="fa fa-fw fa-cloud-download"></topnav>
<div class="page-container">
  <h2>日志收集配置<span style="font-size:14px; margin-left:20px;">* 注意: 请严格按照参考实例格式</span></h2>
  <h4>1. 修改日志配置文件</h4>
  <ul style="list-style:none;">
    <li>
      <p style="word-break: break-all">查找配置文件</p>
      <div class="tight-form last">
        <p class="code-block">/opt/cloudwiz-agent/filebeat-1.3.1/filebeat.yml</p>
      </div>
      <p style="word-break: break-all">修改配置文件</p>
      <div class="tight-form last">
        <p class="code-block">- #这里是配置一种输入日志的开始</p>
        <p class="code-block indent2">paths:</p>
        <p class="code-block indent4 bold"> - /opt/cloudwiz-agent/altenv/var/log/collector.log #需要收集的日志路径(可添加一条或多条)</p>
        <p class="code-block indent4">#如果要添加一个与已有日志格式一致的格式，在已有日志路径下面添加一个日志路路径</p>
        <p class="code-block indent2">input_type: log</p>
        <p class="code-block indent2">document_type: collector</p>
        <p class="code-block indent2">fields:</p>
        <p class="code-block indent4 bold">token: "{{token}}"</p>
        <p class="code-block indent2">fields_under_root: true</p>
        <p class="code-block indent2">close_older: 2h #如果日志在两个小时不更新,则抛弃这个日志</p>
        <p class="code-block indent2">multiline:</p>
        <p class="code-block indent4 bold">pattern: '^[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2},[0-9]{3}' #此处请填写匹配相应日志头的正则表达式</p>
        <p class="code-block indent4">negate: true</p>
        <p class="code-block indent4">match: after</p>
        <p class="code-block">- #配置另一种格式开头的日志</p>
        <p class="code-block indent2">paths:</p>
        <p class="code-block indent4 bold"> - /test.log #test.log的日志格式与collect.log的日志格式不一致，在此处添加</p>
        <p class="code-block indent2">input_type: log</p>
        <p class="code-block indent2">document_type: collector</p>
        <p class="code-block indent2">fields:</p>
        <p class="code-block indent4 bold">token: "{{token}}"</p>
        <p class="code-block indent2">fields_under_root: true</p>
        <p class="code-block indent2">close_older: 2h </p>
        <p class="code-block indent2">multiline:</p>
        <p class="code-block indent4 bold">pattern: '' #此处请填写匹配相应日志头的正则表达式</p>
        <p class="code-block indent4">negate: true</p>
        <p class="code-block indent4">match: after</p>
      </div>
    </li>
  </ul>

  <h4>2. 相关操作<span style="font-size:12px; margin-left:20px;">* 注意: 执行以下操作需要root权限</span></h4>
  <ul style="list-style:lower-roman;">
    <li>
      <p style="word-break: break-all">完成以上配置后,请重启filebeat</p>
      <div class="tight-form last">
        <p  class="code-block">/opt/cloudwiz-agent/altenv/bin/supervisorctl restart cloudwiz-agent:filebeat</p>
      </div>
    </li>
    <li>
      <p style="word-break: break-all">完成安装启动后,您可以检查其状态</p>
      <div class="tight-form last">
        <p  class="code-block">/opt/cloudwiz-agent/altenv/bin/supervisorctl status</p>
      </div>
      <p style="word-break: break-all">如果显示以下信息,则说明配置成功</p>
      <div class="tight-form last">
        <p  class="code-block">cloudwiz-agent:collector         RUNNING   pid 4818, uptime 5 days, 15:32:59</p>
        <p  class="code-block bold">cloudwiz-agent:filebeat          RUNNING   pid 45495, uptime 3 days, 20:14:35
        <p  class="code-block">cloudwiz-agent:uagent            RUNNING   pid 4817, uptime 5 days, 15:32:59</p>
      </div>
    </li>
    <li>
      <p style="word-break: break-all">停止</p>
      <div class="tight-form last">
        <p class="code-block">/opt/cloudwiz-agent/altenv/bin/supervisorctl stop cloudwiz-agent:filebeat</p>
      </div>
    </li>
    <li>
      <p style="word-break: break-all">启动</p>
      <div class="tight-form last">
        <p class="code-block">/opt/cloudwiz-agent/altenv/bin/supervisorctl start cloudwiz-agent:filebeat</p>
      </div>
    </li>
    <li>
      <p style="word-break: break-all">如何做debug</p>
      <div class="tight-form last">
        <p class="code-block">sudo /opt/cloudwiz-agent/agent/run -d</p>
      </div>
    </li>
  </ul>

  <h4>3. 了解更多</h4>
  <p>如果您想了解更多关于filebeat的相关信息，
    <a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuration-filebeat-options.html" target="_blank" style="color:blue">请点击这里</a>
  </p>

</div>

