<topnav section="关键指标" icon="fa fa-fw fa-home"></topnav>

<div class="page-container" style="padding-left:20px;">
    <div class="overview-list" style="box-sizing:border-box;">
        <div class="main-view-container preview-panel">

            <div class="grafana-row" ng-controller="RowCtrl" ng-repeat="(row_name, row) in dashboard.rows" row-height ng-class="{'summary-item':!row.fullwidth}">
                <div class="row-control">
                    <div class="row-control-inner">
                        <div class="row-close" ng-show="row.collapse" data-placement="bottom">
                            <div class="row-close-buttons">
                                <span class="row-button bgPrimary" ng-click="toggleRow(row)">
                                    <i bs-tooltip="'Expand row'" data-placement="right" class="fa fa-caret-left pointer"></i>
                                </span>
                            </div>
                            <div class="row-text pointer" ng-click="toggleRow(row)" ng-bind="row.title | interpolateTemplateVars:this"></div>
                        </div>
                    </div>

                    <div class="panels-wrapper" ng-if="!row.collapse && row.title == '健康指数趋势'">
                        <h3>{{row.title}}</h3>
                        <div ng-repeat="(name, panel) in row.panels" class="panel" ui-draggable="!dashboardViewState.fullscreen"
                            drag="panel.id" ui-on-Drop="onDrop($data, row, panel)" drag-handle-class="drag-handle" panel-width>
                            <div class="health-panel">
                                <div data-placement="center" bs-modal="modal" data-template-url="/app/features/systemoverview/partials/system_overview_modal.html" style="cursor: pointer;">
                                    <em>{{applicationHealth}}</em>
                                    <span>{{leveal}}</span>
                                </div>
                                <div class="progress progress-striped">
                                    <div class="bar bar-{{healthProgressState}}" style="width: {{applicationHealth}}%;"></div>
                                </div>
                                <br>
                                <p>自动检测到所有<strong> {{ summary.numMetrics }} </strong>个指标中: 告警指标 <strong>{{ summary.numAlertsTriggered }} </strong>个  异常指标<strong> {{ summary.numAnomalyMetrics }} </strong>个 <tip>健康值=(告警指标个数/定义规则总数)*50% + (异常指标/所有指标) * 50%</tip></p>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </div>

                    <div class="panels-wrapper" ng-if="!row.collapse && row.title == '报警情况'">
                        <div ng-repeat="(name, panel) in row.panels" class="panel" ui-draggable="!dashboardViewState.fullscreen"
                            drag="panel.id" ui-on-Drop="onDrop($data, row, panel)" drag-handle-class="drag-handle" panel-width>
                            <ul class="btn-list-status clearfix" ng-if="panel.status">
                                <li class="btn-item" style="width:70px; cursor:pointer;" data-placement="center" bs-modal="modal" data-template-url="/app/features/systemoverview/partials/system_overview_modal.html">报警情况:</li>
                                <li ng-if="panel.status.danger[1]!=0"><a href="{{panel.href}}" class="btn-item system-status system-status-danger">{{panel.status.danger[0]}} <span>{{panel.status.danger[1]}}</span></a></li>
                                <li ng-if="panel.status.warn[1]!=0"><a href="{{panel.href}}" class="btn-item system-status system-status-warning">{{panel.status.warn[0]}} <span>{{panel.status.warn[1]}}</span></a></li>
                                <li ng-if="panel.status.success[1]!=0"><a href="{{panel.href}}" class="btn-item system-status system-status-success">{{panel.status.success[0]}} <span>{{panel.status.success[1]}}</span></a></li>
                            </ul>
                            <div class="clearfix"></div>
                        </div>
                    </div>

                    <div class="panels-wrapper" ng-if="!row.collapse && row.title == '智能检测异常指标'">
                        <div ng-repeat="(name, panel) in row.panels" class="panel" ui-draggable="!dashboardViewState.fullscreen"
                            drag="panel.id" ui-on-Drop="onDrop($data, row, panel)" drag-handle-class="drag-handle" panel-width>
                            <ul class="btn-list-status clearfix" ng-if="panel.status">
                                <li class="btn-item" style="width:70px; cursor:pointer;"  data-placement="center" bs-modal="modal" data-template-url="/app/features/systemoverview/partials/system_overview_modal.html">智能检测异常指标:</li>
                                <li ng-if="panel.status.danger[1]!=0"><a href="{{panel.href}}" class="btn-item system-status system-status-danger">{{panel.status.danger[0]}} <span>{{panel.status.danger[1]}}</span></a></li>
                                <li ng-if="panel.status.warn[1]!=0"><a href="{{panel.href}}" class="btn-item system-status system-status-warning">{{panel.status.warn[0]}} <span>{{panel.status.warn[1]}}</span></a></li>
                                <li ng-if="panel.status.success[1]!=0"><a href="{{panel.href}}" class="btn-item system-status system-status-success">{{panel.status.success[0]}} <span>{{panel.status.success[1]}}</span></a></li>
                            </ul>
                            <div class="clearfix"></div>
                        </div>
                    </div>

                    <div class="panels-wrapper" ng-if="!row.collapse && row.title == '服务状态'">
                        <h3>{{row.title}}</h3>
                        <div ng-repeat="(name, panel) in row.panels" class="panel" ui-draggable="!dashboardViewState.fullscreen"
                            drag="panel.id" ui-on-Drop="onDrop($data, row, panel)" drag-handle-class="drag-handle" panel-width>
                            <!--<ul class="btn-list-status clearfix" ng-if="panel.status">
                                <li class="btn-item" style="width:70px;">当前状态:</li>
                                <li ng-if="panel.status.danger[1]!=0"><a href="{{panel.href}}" class="btn-item system-status system-status-danger">{{panel.status.danger[0]}} <span>{{panel.status.danger[1]}}</span></a></li>
                                <li ng-if="panel.status.warn[1]!=0"><a href="{{panel.href}}" class="btn-item system-status system-status-warning">{{panel.status.warn[0]}} <span>{{panel.status.warn[1]}}</span></a></li>
                                <li ng-if="panel.status.success[1]!=0"><a href="{{panel.href}}" class="btn-item system-status system-status-success">{{panel.status.success[0]}} <span>{{panel.status.success[1]}}</span></a></li>
                            </ul>-->
                            <ul class="btn-list-status clearfix" ng-if="panel.allServices">
                                <li ng-repeat="(name, service) in panel.allServices">
                                    <button type="button" class="btn-item system-status system-status-{{ service.state==0 ? 'success' : 'warning' }}" data-template-url="/app/features/systemoverview/partials/system_service_status.html" data-auto-close="1" data-placement="bottom" bs-popover ng-click="test()">{{service.name}}</button>
                                </li>
                            </ul>
                            <div class="clearfix"></div>
                            <!--<panel-loader type="panel.type" class="panel-margin overview-panel"></panel-loader>-->
                        </div>
                    </div>

                    <div class="panels-wrapper" ng-if="!row.collapse && row.title == '机器连接状态'">
                        <h3>{{row.title}}</h3>
                        <!--<div ng-repeat="(name, panel) in row.panels" class="panel" ui-draggable="!dashboardViewState.fullscreen"
                            drag="panel.id" ui-on-Drop="onDrop($data, row, panel)" drag-handle-class="drag-handle" panel-width>
                            <panel-loader type="panel.type" class="panel-margin overview-panel"></panel-loader>
                        </div>-->
                        <table class="table" data-toggle="table">
                            <thead>
                                <th>机器</th><th>状态</th><th>CPU</th><th>内存</th><th>磁盘剩余空间</th>
                            </thead>
                            <tbody>
                                <tr ng-repeat="host in hostPanels" ng-click="showPrediction($index)">
                                    <td>{{ host.host }}</td>
                                    <td>{{ host.status }}</td>
                                    <td>{{ host.cpu }}</td>
                                    <td>{{ host.mem }}</td>
                                    <td>{{ host.disk }}</td>
                                </tr>
                            </tbody> 
                        </table>
                        <div class="panel-group" ng-model="hostPanels.activePanel" role="tablist" aria-multiselectable="true" bs-collapse>
                            <div class="panel panel-default" ng-repeat="host in hostPanels">
                                <div class="panel-heading" role="tab" bs-collapse-toggle>
                                <h4 class="panel-title">
                                </h4>
                                </div>
                                <div class="panel-collapse" role="tabpanel" bs-collapse-target>
                                    <div class="panel-body">
                                        <!--<table class="table">
                                            <thead></thead>
                                            <tbody></tbody>
                                        </table>-->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="panels-wrapper" ng-if="!row.collapse && row.title == '智能分析预测'">
                        <!--<h3>{{row.title}}</h3>-->
                        <div ng-repeat="(name, panel) in row.panels" class="panel" ui-draggable="!dashboardViewState.fullscreen"
                            drag="panel.id" ui-on-Drop="onDrop($data, row, panel)" drag-handle-class="drag-handle" panel-width>
                            <!--<div class="panel-heading" role="tab" bs-collapse-toggle></div>
                            <div class="panel-collapse" role="tabpanel" bs-collapse-target>-->
                                <p ng-if="panel.tip">
                                    <i class="fa fa-info-circle" style="padding: 0 10px;"></i>
                                    <span ng-if="panel.tips.length">预计未来</span>
                                    <select ng-if="panel.tips.length" style="width:66px;"
                                            ng-model="panel.selectedOption"
                                            ng-change="changePre(panel.selectedOption)"
                                            ng-options="tip.time for tip in panel.tips">
                                    </select>
                                    {{panel.tip + panel.selectedOption.data}}
                                </p>
                                <div class="clearfix"></div>
                                <panel-loader type="panel.type" class="panel-margin overview-panel"></panel-loader>
                            <!--</div>-->
                        </div>
                    </div>

                    <div class="panels-wrapper" ng-if="!row.collapse && row.title == '各进程TopN使用情况'">
                        <h3>{{row.title}}</h3>
                        <div ng-repeat="(name, panel) in row.panels" class="panel" ui-draggable="!dashboardViewState.fullscreen"
                            drag="panel.id" ui-on-Drop="onDrop($data, row, panel)" drag-handle-class="drag-handle" panel-width>
                            <div class="clearfix"></div>
                            <panel-loader type="panel.type" class="panel-margin overview-panel"></panel-loader>
                        </div>
                    </div>

                    
                    <div class="clearfix"></div>
                </div>
            </div>
            <div class="clearfix"></div>

        </div>
    </div>
</div>